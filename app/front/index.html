<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ERP360 Comercial</title>
    <!-- Tailwind CSS se carga desde el archivo CSS compilado -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>
    <script>
      // Aplica el tema oscuro por defecto para evitar parpadeos
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    </script>
    <style>
      :root {
        --color-primario: #002B5B;
        --color-secundario: #F53F3F;
      }

      body {
        font-family: 'Inter', sans-serif;
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
        margin: 0 !important;
        padding: 0 !important;
        position: relative;
      }
      
      html {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
        overflow-y: auto;
      }
      
      /* Forzar que el viewport no tenga overflow horizontal */
      body, html {
        box-sizing: border-box;
      }
      
      *,
      *::before,
      *::after {
        box-sizing: inherit;
      }
      
      /* Custom Scrollbar Styles - Refined to match theme aesthetics */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background-color: #f8fafc; /* bg-slate-50 */
      }
      ::-webkit-scrollbar-thumb {
        background-color: #e2e8f0; /* slate-200 */
        border-radius: 4px;
        border: 2px solid #f8fafc; /* Creates a padding effect */
      }
      ::-webkit-scrollbar-thumb:hover {
        background-color: #cbd5e1; /* slate-300 */
      }

      html.dark ::-webkit-scrollbar-track {
        background-color: #0f172a; /* bg-slate-900 */
      }
      html.dark ::-webkit-scrollbar-thumb {
        background-color: #334155; /* slate-700 */
        border: 2px solid #0f172a; /* Padding effect for dark mode */
      }
      html.dark ::-webkit-scrollbar-thumb:hover {
        background-color: #475569; /* slate-600 */
      }

      /* Responsive Stat Card Value */
      .responsive-stat-value {
        font-size: clamp(1rem, 2vw + 0.5rem, 1.5rem);
      }

      /* Markdown Preview Styles */
      .markdown-preview h1, .markdown-preview h2, .markdown-preview h3 {
        border-bottom: 1px solid #374151; /* slate-700 */
        padding-bottom: 0.3em;
        margin-top: 24px;
        margin-bottom: 16px;
      }
      .markdown-preview h1 { font-size: 2em; font-weight: 600; }
      .markdown-preview h2 { font-size: 1.5em; font-weight: 600; }
      .markdown-preview h3 { font-size: 1.25em; font-weight: 600; }
      .markdown-preview p { margin-bottom: 16px; line-height: 1.5; }
      .markdown-preview a { color: #3b82f6; text-decoration: underline; } /* sky-500 */
      .markdown-preview ul, .markdown-preview ol { padding-left: 2em; margin-bottom: 16px; }
      .markdown-preview li { margin-bottom: 0.25em; }
      .markdown-preview code {
        font-family: 'Courier New', Courier, monospace;
        background-color: #1e293b; /* slate-800 */
        color: #e2e8f0; /* slate-200 */
        padding: 0.2em 0.4em;
        border-radius: 6px;
      }
      .markdown-preview pre {
        background-color: #0f172a; /* slate-900 */
        padding: 16px;
        border-radius: 6px;
        overflow-x: auto;
        margin-bottom: 16px;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .markdown-preview pre code {
        background-color: transparent;
        padding: 0;
      }
      .markdown-preview table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 16px;
      }
      .markdown-preview th, .markdown-preview td {
        border: 1px solid #374151; /* slate-700 */
        padding: 8px 12px;
      }
      .markdown-preview th {
        background-color: #1e293b; /* slate-800 */
      }
      .markdown-preview blockquote {
        border-left: 4px solid #475569; /* slate-600 */
        padding-left: 16px;
        margin-left: 0;
        margin-bottom: 16px;
        color: #94a3b8; /* slate-400 */
      }
      
      /* Print-specific Styles */
      @media print {
        body > *:not(.print-container) {
          display: none !important;
        }
        .print-container {
          display: block !important;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: 9999;
          overflow: visible;
          background: white;
        }
         .print-content, .print-content * {
            color: #000 !important;
            background: transparent !important;
            box-shadow: none !important;
            text-shadow: none !important;
         }
         .print-content a {
            text-decoration: none;
         }
        .no-print {
          display: none !important;
        }
      }
    </style>
<!-- CSS se importa desde index.tsx, Vite lo procesará automáticamente -->
</head>
  <body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300">
    <div id="root">
      <!-- Loading fallback mientras React se monta -->
      <div id="loading-fallback" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; gap: 1rem;">
        <div style="width: 48px; height: 48px; border: 4px solid #e2e8f0; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="color: #64748b; font-size: 0.875rem;">Cargando ERP360...</p>
      </div>
    </div>
    <style>
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
    <script>
      // Ocultar el fallback cuando React se monte
      window.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
          const fallback = document.getElementById('loading-fallback');
          if (fallback && document.getElementById('root').children.length > 1) {
            fallback.style.display = 'none';
          }
        }, 100);
      });
      
      // Detectar errores de carga
      window.addEventListener('error', function(e) {
        console.error('Error global:', e.error);
        const fallback = document.getElementById('loading-fallback');
        if (fallback) {
          fallback.innerHTML = `
            <div style="text-align: center; padding: 2rem; max-width: 600px;">
              <h2 style="color: #ef4444; margin-bottom: 1rem;">Error al cargar la aplicación</h2>
              <p style="color: #64748b; margin-bottom: 1rem;">${e.message || 'Error desconocido'}</p>
              <button onclick="window.location.reload()" style="padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 0.375rem; cursor: pointer;">
                Recargar página
              </button>
            </div>
          `;
        }
      });
    </script>
    <script>
      // Polyfill para convertir oklch a rgb antes de que html2canvas lo procese
      (function() {
        function oklchToRgb(l, c, h) {
          // Conversión aproximada de oklch a rgb
          l = l / 100;
          h = h * Math.PI / 180;
          const a = c * Math.cos(h);
          const b = c * Math.sin(h);
          
          // oklab a linear rgb (aproximación simplificada)
          const x = l + 0.3963377774 * a + 0.2158037573 * b;
          const y = l - 0.1055613458 * a - 0.0638541728 * b;
          const z = l - 0.0894841775 * a - 1.2914855480 * b;
          
          const r = linearToSrgb(x);
          const g = linearToSrgb(y);
          const bl = linearToSrgb(z);
          
          return [Math.round(r * 255), Math.round(g * 255), Math.round(bl * 255)];
        }
        
        function linearToSrgb(c) {
          return c <= 0.0031308
            ? 12.92 * c
            : 1.055 * Math.pow(c, 1 / 2.4) - 0.055;
        }

        function convertOklchToRgb(value) {
          if (typeof value !== 'string') return value;
          return value.replace(/oklch\(([\d.]+)%?\s+([\d.]+)\s+([\d.]+)\)/g, function(match, l, c, h) {
            const lNum = parseFloat(l);
            const cNum = parseFloat(c);
            const hNum = parseFloat(h);
            const rgb = oklchToRgb(lNum, cNum, hNum);
            return `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
          });
        }

        const originalGetComputedStyle = window.getComputedStyle;
        window.getComputedStyle = function(...args) {
          const style = originalGetComputedStyle.apply(window, args);
          
          // Crear un proxy que intercepta todas las propiedades
          return new Proxy(style, {
            get: function(target, prop) {
              // Obtener el valor original
              const value = target[prop];
              
              // Convertir oklch a rgb si es un string
              if (typeof value === 'string' && value.includes('oklch')) {
                return convertOklchToRgb(value);
              }
              
              // Para métodos y propiedades especiales, devolverlos tal cual
              if (typeof value === 'function') {
                return value.bind(target);
              }
              
              return value;
            },
            ownKeys: function(target) {
              return Reflect.ownKeys(target);
            },
            getOwnPropertyDescriptor: function(target, prop) {
              const descriptor = Reflect.getOwnPropertyDescriptor(target, prop);
              if (descriptor && typeof descriptor.value === 'string' && descriptor.value.includes('oklch')) {
                const convertedValue = convertOklchToRgb(descriptor.value);
                return {
                  ...descriptor,
                  value: convertedValue
                };
              }
              return descriptor;
            }
          });
        };
      })();
    </script>
    <!-- Cargar librerías de PDF antes de la aplicación -->
    <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js" 
            onerror="console.error('Error cargando html2canvas')"
            onload="console.log('html2canvas cargado correctamente'); window.__html2canvasLoaded = true;"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js" 
            onerror="console.error('Error cargando jsPDF')"
            onload="console.log('jsPDF cargado correctamente'); window.__jspdfLoaded = true;"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module" src="/index.tsx"></script>
    <script>
      // Verificar que las librerías se carguen correctamente
      window.addEventListener('load', function() {
        setTimeout(function() {
          if (!window.html2canvas) {
            console.error('⚠️ html2canvas no se cargó correctamente');
          } else {
            console.log('✅ html2canvas disponible');
          }
          if (!window.jspdf) {
            console.error('⚠️ jsPDF no se cargó correctamente');
          } else {
            console.log('✅ jsPDF disponible');
          }
        }, 1000);
      });
    </script>
  </body>
</html>